<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Minesweeper Calculator</title>
  <link rel="icon" href="images/favicon.png" type="image/png">
  <link rel="stylesheet" type="text/css" href="index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css"
    integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js"
    integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"
    integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
  <script src="coi-serviceworker.js"></script>
  <script type="module" src="index.js"></script>
</head>

<body>
  <div id="flash-body"><strong id="flash-close">X</strong><div id="flash-content"></div></div>
  <div id="grid-body" class="no-highlight"></div>
  <div id="all-right-tabs" class="right-tabs-normal">
    <div class="tabs-button" data-tab="about-tab">
      About
    </div>
    <div class="tabs-button">
      <a href="https://github.com/CornSnek/minesweeper_probability_calculator" target="_blank"
        rel="noopener noreferrer">GitHub Source</a>
    </div>
    <div class="tabs-button" data-tab="patterns-tab">
      Minesweeper Patterns
    </div>
    <div class="tabs-button" data-tab="options-tab">
      Options
    </div>
    <div id="calculate-probability" class="tabs-button">
      Calculate Probability
    </div>
    <div id="progress-div" style="display: none;">
      <progress id="subsystem-progress" value="0"></progress>
      <progress id="calculate-progress" value="0"></progress>
    </div>
    <div id="results-tab-button" class="tabs-button" data-tab="results-tab">
      Probability Results
    </div>
    <div id="clear-probability-button" class="tabs-button">
      Clear Results
    </div>
    <div id="clear-all-button" class="tabs-button">
      Clear All
    </div>
  </div>
  <div id="all-options-gui">
    <div id="about-tab" class="options-gui panel-hide-right">
      <div>
        <a href="#" class="close-options-panel"><strong class="badge">Close</strong></a>
      </div>
      <br>
      <div>
        This web app calculates the probabilities of adjacent tiles for mines.<br><br>Fractions equaling 0 (green) is
        guaranteed to be a safe number tile, and 1 (red) is guaranteed to be a mine.<br><br>
        Only tiles that are near number tiles (sides and diagonally) will have their probability calculated.<br><br>The
        web app calculates the probability by first gathering all the tiles
        that are near number tiles, assign id numbers for each unique tile, and creates a system of equations of each
        number tile using the ids.<br><br>
        Each id is assigned 1 it is near the number tile, or 0 if not near it.<br><br>The web app will attempt to solve
        the equations in order
        to find all possible solutions.<br><br>For each valid solution, each id number is assigned 0 (no mine) or 1
        (mine).<br><br>
        The probability fraction is calculated by summing Each 0 or 1 from each solution, divided by the number of total
        valid solutions.<br><br>
        See the Probability Results tab to see an example of the matrix calculations in action.<br><br>
        Please note that this calculator does not include the global count of mines (yet). The probability only
        considers
        the adjacent tiles only.
      </div>
    </div>

    <div id="patterns-tab" class="options-gui panel-hide-right">
      <div>
        <a href="#" class="close-options-panel"><strong class="badge">Close</strong></a>
      </div>
      <br>
      <div id="patterns-body">
        One main reason why I made this probability calculator was to also find and check the validity of Minesweeper
        patterns.
        <br>
        <br>
        A pattern, in the context of this calculator, is where all valid solutions for certain adjacent tiles are either guaranteed safe or
        a mine. You can click each board for each pattern below to copy the data to the clipboard and paste to the main board to see the probability calculations.
        <br>
        <br>
        Note: These aren't official names for these patterns. For more information and the logic on these patterns, see <b><a href="https://minesweeper.online/help/patterns" target="_blank"
        rel="noopener noreferrer">https://minesweeper.online/help/patterns</a></b>, <b><a href="https://computronium.org/minesweeper/index.html" target="_blank"
        rel="noopener noreferrer">https://computronium.org/minesweeper/index.html</a></b>, and <b><a href="https://www.youtube.com/@minesweeperstrategy7245" target="_blank" rel="noopener noreferrer">https://www.youtube.com/@minesweeperstrategy7245</a></a></b>
        <ul id="patterns-list">
          <li>
            <b>Number of Empty Spaces = Number of Mines</b>
            <div>
              This is a common pattern that you will see. Here is a corner 1. Since all spaces but the bottom right is
              filled as safe, the bottom right tile must be a mine.
              <div class="tile-template" data-ncolumns="5" data-str="ccccc,cxxxc,cx1xc,cxxv.c,ccccc,"></div>
              <br>
              Because the 2 is near a wall and 3 adjacent tiles around the 2 are safe, the unknown tiles next to the 2 must be mines.
              <div class="tile-template" data-ncolumns="4" data-str="x2v.c,xxv.c,cccc,"></div>
              <br>
              Here is an example of a 1-2-3-2-1 wall, where the 3 tiles near the red 3 are mines due to this pattern.
              <div class="tile-template" data-ncolumns="7" data-str="c.c.v.v.v.c.c.,x12321x,xxxxxxx,"></div>
            </div>
          </li>
          <li>
            <b>Flag Number Reduction</b>
            <div>
              Whenever you see flags/mines near number tiles, subtract the number by the number of adjacent flag tiles.
              Here is an example including the <b>Number of Empty Spaces = Number of Mines</b> pattern. The 3 becomes a 2,
              and the 2 unknown tiles above must be mines.
              <div class="tile-template" data-ncolumns="5" data-str="cxv.v.c,cx3xc,cx1fc,xx1xx,"></div>
              <br>
              Reducing numbers is then combined with other patterns. For example, here a wall of 3-3-2 is a disguised <b>1-2-1</b> pattern. The tiles above the 1s must be mines.
              <div class="tile-template" data-ncolumns="6" data-str="c.v.c.v.c.c.,f3322x,f21f10,111110,000000,"></div>
            </div>
          </li>
          <li>
            <b>Adjacent Tiles Near 0</b>
            <div>
              All the tiles near 0 must be safe. Generally in Minesweeper and its game clones, they automatically click
              all 0 tiles and the safe adjacent tiles near the 0s. You generally do not have to manually click 0s as safe.
              <div class="tile-template" data-ncolumns="5" data-str="ccccc,cc.c.c.c,cc.0c.c,cc.c.c.c,ccccc,"></div>
              <br>
              However, when using the <b>Flag Number Reduction</b> pattern, if all flags were placed on a number tile, the rest
              of the tiles near the number must be safe.
              <br>For example, the 3s and the 1s shown both become 0, making all adjacent tiles safe.
              <div class="tile-template" data-ncolumns="5" data-str="ccccc,xffc.c,x33c.c,x1fc.c,x1c.cc,"></div>
            </div>
          </li>
          <li>
            <b>1-1</b>
            <div>
              If a 1-1 pattern is near a wall, or has a tile blocking one side of the 1-1, the corner near the 1-1 is safe.
              <div class="tile-template" data-ncolumns="7" data-str="xxc.cccc,x1ccccc,x1ccccc,xxxcc.xx,xxccc1x,xxccc1x,"></div>
              <br>
              Here is an example of a chain of successive 1-1 due to being near a wall and the tile is blocked at the same time.
              <div class="tile-template" data-ncolumns="13" data-str="xxxxxxxxxxxxc,11111111111xc,ccc.ccc.ccc.ccc.c,ccccccccccccc,"></div>
              <br>
              A 1-1 can also allow more than one tile to be guaranteed as safe.
              <div class="tile-template" data-ncolumns="5" data-str="ccccc,cc.c.c.c,cx1cc,cx1cc,cxxxc,ccccc,"></div>
            </div>
          </li>
          <li>
            <b>1-2</b>
            <div>
              A corner near the 2 is guaranteed a mine, and adjacent tiles of the 1 not adjacent of the 2 is guaranteed safe.
              <div class="tile-template" data-ncolumns="10" data-str="cc.ccv.cc.ccv.,cx12xcc.12x,cxxxxcc.xxx,"></div>
            </div>
          </li>
          <li>
            <b>1-2-1</b>
            <div>
              This pattern is an extension of the <b>1-2</b> pattern, where the mines are always on the sides of the 1s and are touching the corner of the 2.
              <div class="tile-template" data-ncolumns="5" data-str="c.v.c.v.c.,c.121c.,c.xxxc.,cxxxc,"></div>
            </div>
          </li>
          <li>
            <b>1-2-2-1</b>
            <div>
              This pattern is an extension of the <b>1-2</b> pattern, where the mines are always on the sides of the 2s and are touching the corner of the 1s.
              <div class="tile-template" data-ncolumns="6" data-str="c.c.v.v.c.c.,c.1221c.,c.x00xc.,cxxxxc,"></div>
              <br>
              Here is an example of a disguised 1-2-2-1 with the Flag Number Reduction pattern. The 1-2-3-3 column with the flags become a 1-2-2-1. Note: The mines could be in either side, but all the sides not near the 2s on the left/right are safe.
              <div class="tile-template" data-ncolumns="3" data-str="c.c.c.,c.1c.,c2c,c3c,f3c.,fc.c.,"></div>
            </div>
          </li>
          <li>
            <b>1-3-1 Corner</b>
            <div>
              This pattern has a mine on the outer corner of the 3, and safe tiles on the corner of the 1s not touching the 3.
              <div class="tile-template" data-ncolumns="4" data-str="c.ccv.,x13c,xx1c,xxxc.,"></div>
            </div>
          </li>
          <li>
            <b>2-2-2 Corner</b>
            <div>
              This pattern does the inverse of the <b>1-3-1 Corner</b> pattern, where safe tiles are mines, and the mine tile is safe.
              <div class="tile-template" data-ncolumns="4" data-str="v.ccc.,x22c,xx2c,cxxv.,"></div>
            </div>
          </li>
          <li>
            <b>2D 1-1, 2-2, 3-3</b>
            <div>
              For this pattern, generally if the number is the same as the left (1, 2, or 3), then the 3 tiles on the right must be safe.
              <div class="tile-template" data-ncolumns="14" data-str="xccc.cxccc.cxv.v.c.,x11c.cx22c.cx33c.,xxcc.cxxcc.cxxv.c.,xxcccxxcccxxcc,"></div>
              <br>
              Note that the bottom X on the leftmost tile is not required for the right 3 tiles to be safe.
              <div class="tile-template" data-ncolumns="14" data-str="xccc.cxccc.cxccc.,x11c.cx22c.cx33c.,xccc.cxccc.cxccc.,"></div>
            </div>
          </li>
          <li>
            <b>2D 1-1, 2-2, 3-3 Special Cases</b>
            <div>
              More special case patterns can be found for these 2D 1-1, 2-2, and 3-3.
              <br>
              For the 2D 1-1 and 2-2, when clicking the 3 safe tiles, if the middle is also a 1 or 2 respectively, then the next 3 tiles on the right are also safe too. Please note the additional safe X tiles above the top and bottom of the leftmost 1 of 2 in order to do this.
              <div class="tile-template" data-ncolumns="11" data-str="xxcxc.cxxv.xc.,x111c.cx222c.,xxcxc.cxxv.xc.,xxccccxxccc,"></div>
              <br>
              Here is a special case 2D 1-1, where the bottommost 1 tile (Of the 3 safe tiles) matches the 1 tile on the left. This makes the 4 adjacent tiles on the bottom and right safe.
              <br>
              Note: The 2D 1-1 can also be 2D 2-2 and 3-3 as well.
              <div class="tile-template" data-ncolumns="5" data-str="xccxc,x11xc.,x1c1c.,x1cc.c.,"></div>
              <br>
              Here is another special case of a 2D 3-3, where the bottommost 2 tile (Of the 3 safe tiles) matches the 2 tile on the left. This makes the 4 adjacent tiles on the bottom and right safe.
              Additionally, the tiles between the 2s are mines.
              <br>
              Note: The 2D 3-3 can also be 2D 1-1 and 2-2 as well.
              <div class="tile-template" data-ncolumns="5" data-str="xv.v.xc,x33xc.,x2v.2c.,xxv.c.c.,xxccc,xxccc,"></div>
            </div>
          </li>
          <li>
            <b>1-3 and 1-4</b>
            <div>
              These are similar to the <b>1-2 Pattern</b>, where the tiles left of the 1 must be safe, and the other tiles on the right must be mines.
              <br>
              <br>
              Example of 1-3:
              <div class="tile-template" data-ncolumns="4" data-str="c.ccv.,c.13v.,c.xxx,xxxx,"></div>
              <br>
              Example of 1-4:
              <div class="tile-template" data-ncolumns="4" data-str="c.ccv.,c.14v.,c.xxv.,xxxc,"></div>
            </div>
          </li>
          <li>
            <b>2D 1-4, 2-5, 3-6, and 4-7</b>
            <div>
              These patterns show that the tiles are safe on the top 3 adjacent tiles, but there are mines on the bottom 3 adjacent tiles. There is an exception of the 4-7 with additional guaranteed mines.
              <div class="tile-template" data-ncolumns="12" data-str="c.c.c.c.c.c.c.c.c.c.c.c.,c1cc2cc3cv.4v.,c4cc5cc6cv.7v.,v.v.v.v.v.v.v.v.v.v.v.v.,"></div>
            </div>
          </li>
          <li>
            <b>2D 1-2-1, 1-3-2, and 2-4-2</b>
            <div>
              These patterns show 8 tiles that are on the left, the right, and the middle. The exceptions are that the 1-3-2 have mines on top and bottom of the 2, and the 2-4-2 have mines on the corner of the 4s.
              <br>
              Basically, a 2-4-2 is a <b>1-2-1</b> pattern with mines on all sides except on top and bottom of 4, and left and right of the 2s.
              <div class="tile-template" data-ncolumns="10" data-str="c.cc.cc.c.cc.v.c.,c.121c.c.132c.,c.cc.cc.c.cc.v.c.,c.v.c.v.c.ccccc,c.242c.ccccc,c.v.c.v.c.ccccc"></div>
            </div>
          </li>
          <li>
            <b>1-1-1 and 1-1-1-1</b>
            <div>
              Using the <b>Flag Number Reduction</b> pattern, these patterns are disguised, but behave similarly to the <b>1-2-1</b> and <b>1-2-2-1</b> pattern. However, the mine and safe tiles for 1-2-1 and 1-2-2-1 are inversed for 1-1-1 and 1-1-1-1.
              <br>
              Here is an example of a disguised 1-1-1
              <div class="tile-template" data-ncolumns="3" data-str="xfx,c.2x,v.1x,c.4x,fff,"></div>
              <br>
              Here is an example of a disguised 1-1-1-1
              <div class="tile-template" data-ncolumns="3" data-str="xfx,v.2x,c.1x,c.1x,v.4x,fff,"></div>
            </div>
          </li>
          <li>
            <b>Shared Mines in Regions</b>
            <div>
              For a region of tiles, if you know that mines can be shared for 2 different number tiles, you can use this information to do the <b>Flag Number Reduction</b> pattern to use with other patterns.
              <br>
              <br>
              For a simple example, the rightmost 2 tile must share at least 2 mines in the ? regions with the leftmost 2 tile. Therefore, the leftmost 2 becomes a 0, thus the other adjacent tiles for the leftmost tile must be free due to the <b>Adjacent Tiles Near 0</b> pattern.
              <div class="tile-template" data-ncolumns="5" data-str="xxxxx,xxc?xx,c.2c?2x,c.c.c?xx,"></div>
              <br>
              Here is another example that uses another pattern. For the 2 bottom tile numbers, 1 mine must be in one of the 2 tiles while the other is safe.<br>Moreover, the 2 number tile on top of the region shares the mine. This makes the 2 tile be a 1 tile.<br>Due to these circumstances, this creates a <b>2D 1-1</b> pattern, allowing the top tiles on the topmost 1 tile to be safe. 
              <div class="tile-template" data-ncolumns="5" data-str="ccc.c.c.,ccc1x,ccc2x,cxc?c?x,xf21x,xxxxx,"></div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <div id="options-tab" class="options-gui panel-hide-right">
      <div>
        <a href="#" class="close-options-panel"><strong class="badge">Close</strong></a>
      </div>
      <br>
      <div>
        <label for="columns-num">Columns</label>
        <input id="columns-num" value="10">
        <br>
        <label for="rows-num">Rows</label>
        <input id="rows-num" value="10">
        <br>
        <button type="button" id="generate-grid">Generate</button>
        <br><br>
        <label for="show-results-check>">Show Probability Results</label>
        <input type="checkbox" id="show-results-check">
        <br><br>
        <label for="get-gm-probability">Get Global Mine Probability</label>
        <input type="checkbox" id="get-gm-probability">
        <br>
        <label for="gm-count">Global Mine Count</label>
        <input id="gm-count" value="10">
      </div>
    </div>
    <div id="results-tab" class="options-gui panel-hide-right">
      <div>
        <a href="#" class="close-options-panel"><strong class="badge">Close</strong></a>
      </div>
      <br>
      <div id="probability-results-text">
        Results are shown after clicking 'Probability Results'
      </div>
    </div>
  </div>
  <div id="tile-gui" class="panel-hide-down">
    <div>
      Use <strong class="badge">Escape</strong> to deselect a tile.
      Hold down <strong class="badge">Shift</strong> and click to multi-select more than one tile.
      Use the arrow keys <strong class="badge">&uarr;</strong><strong class="badge">&darr;</strong><strong
        class="badge">&larr;</strong><strong class="badge">&rarr;</strong>
      or <strong class="badge">W</strong><strong class="badge">A</strong><strong class="badge">S</strong><strong
        class="badge">D</strong> to move the select region by 1 tile.
      You can hover over each tile below for its description. You can also use keys on each tile below to add to the
      board. <strong class="badge">Ctrl</strong>+<strong class="badge">C</strong>,
      <strong class="badge">Ctrl</strong>+<strong class="badge">X</strong>, and
      <strong class="badge">Ctrl</strong>+<strong class="badge">V</strong> can be used to copy, cut, and paste tile data
      respectively.
    </div>
    <div id="tiles-palette-container">
      <div id="tiles-palette"></div>
      <div id="tile-description"></div>
    </div>
  </div>
</body>